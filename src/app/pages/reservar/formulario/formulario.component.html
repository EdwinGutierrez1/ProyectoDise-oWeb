<!-- Sección principal del formulario de cotización -->
<div class="formulario-section">

  <!-- Encabezado del formulario -->
  <div class="formulario-header">
    <h2 class="formulario-titulo">Cotiza tu experiencia</h2>
    <p class="formulario-subtitulo">Complete sus datos para finalizar la reserva</p>
  </div>

  <!-- Contenido principal dividido en dos secciones -->
  <div class="formulario-contenido">

    <!-- FORMULARIO - LADO IZQUIERDO -->
    <div class="formulario-container">
      <h3 class="seccion-titulo">
        <i class="fas fa-user-edit"></i>
        Información Personal
      </h3>

      <!-- Formulario con validación de Angular -->
      <form id="cotizar-form" #cotizarForm="ngForm" (ngSubmit)="onSubmit($event)" novalidate>
        
        <!-- Mensaje de confirmación al enviar -->
        <div class="mensaje-confirmacion" *ngIf="mensajeEnviado">
          <i class="fas fa-check-circle"></i>
          ¡Tu información fue enviada exitosamente!
        </div>

        <!-- Campo para ingresar el nombre -->
        <div class="form-group">
          <label for="nombre">
            <i class="fas fa-user"></i>
            Nombre completo
          </label>
          <input type="text" class="form-control" id="nombre" name="nombre" required minlength="1" [(ngModel)]="nombre" #nombreCtrl="ngModel">
          <div class="invalid-feedback" *ngIf="esCampoInvalido('nombre')">
            {{ obtenerErrorCampo('nombre') }}
          </div>
        </div>

        <!-- Campo para ingresar el correo electrónico -->
        <div class="form-group">
          <label for="email">
            <i class="fas fa-envelope"></i>
            Correo electrónico
          </label>
          <input type="email" class="form-control" id="email" name="email" required pattern="^[^@\s]+@[^@\s]+\.com$" [(ngModel)]="email" #emailCtrl="ngModel">
          <div class="invalid-feedback" *ngIf="emailCtrl.invalid && (emailCtrl.dirty || emailCtrl.touched)">
            <span *ngIf="emailCtrl.errors?.['required']">El correo es obligatorio.</span>
            <span *ngIf="emailCtrl.errors?.['pattern']">Correo no válido.</span>
          </div>
        </div>

        <!-- Campo para ingresar el teléfono y la fecha de llegada -->
        <div class="form-row">
          <div class="form-group">
            <label for="telefono">
              <i class="fas fa-phone"></i>
              Teléfono
            </label>
            <input type="tel" class="form-control" id="telefono" name="telefono" required pattern="^[0-9]{7,15}$" [(ngModel)]="telefono" #telefonoCtrl="ngModel">
            <div class="invalid-feedback" *ngIf="telefonoCtrl.invalid && (telefonoCtrl.dirty || telefonoCtrl.touched)">
              <span *ngIf="telefonoCtrl.errors?.['required']">El teléfono es obligatorio.</span>
              <span *ngIf="telefonoCtrl.errors?.['pattern']">Solo números (7-15 dígitos).</span>
            </div>
          </div>
          <div class="form-group">
            <label for="fecha">
              <i class="fas fa-calendar"></i>
              Fecha de llegada
            </label>
            <input type="date" class="form-control" id="fecha" name="fecha" required [(ngModel)]="fechaLlegada" #fechaCtrl="ngModel">
            <div class="invalid-feedback" *ngIf="fechaCtrl.invalid && (fechaCtrl.dirty || fechaCtrl.touched)">
              <span *ngIf="fechaCtrl.errors?.['required']">La fecha es obligatoria.</span>
            </div>
          </div>
        </div>

        <!-- Campo de comentarios adicionales -->
        <div class="form-group">
          <label for="comentarios">
            <i class="fas fa-comment"></i>
            Comentarios adicionales
          </label>
          <textarea class="form-control" id="comentarios" name="comentarios" rows="4"
            placeholder="Solicitudes especiales, preguntas adicionales..."></textarea>
        </div>

        <!-- Botones de acción -->
        <div class="botones-container">
          <button type="button" class="btn-volver" (click)="onVolver()">
            <i class="fas fa-arrow-left"></i>
            Volver
          </button>
          <button type="submit" class="btn-cotizar" [disabled]="cotizarForm.invalid">
            <i class="fas fa-paper-plane"></i>
            Enviar Reservación
          </button>
        </div>
      </form>
    </div>

    <!-- COTIZACIÓN - LADO DERECHO -->
    <div class="cotizacion-container">
      <h3 class="seccion-titulo">
        <i class="fas fa-receipt"></i>
        Resumen de Cotización
      </h3>

      <!-- Tabla de cotización con detalles -->
      <div class="tabla-cotizacion">
        <table class="cotizacion-table">
          <thead>
            <tr>
              <th>Cant.</th>
              <th>Producto/Servicio</th>
              <th>Precio Unit.</th>
              <th>Subtotal</th>
            </tr>
          </thead>
          <tbody id="tabla-productos">
            <!-- Filas dinámicas generadas con Angular -->
          </tbody>
        </table>
      </div>

      <!-- Totales y cálculos -->
      <div class="totales-container">
        <div class="total-fila subtotal">
          <span class="total-label">Subtotal:</span>
          <span class="total-valor">${{ formatearPrecio(subtotalGeneral) }}</span>
        </div>
        <div class="total-fila iva">
          <span class="total-label">IVA (19%):</span>
          <span class="total-valor">${{ formatearPrecio(iva) }}</span>
        </div>
        <div class="total-fila total-final">
          <span class="total-label">Total Final:</span>
          <span class="total-valor">${{ formatearPrecio(total) }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de confirmación -->
  <div class="modal-backdrop" *ngIf="mostrarPopup" (click)="cerrarPopup()">
    <div class="modal" (click)="$event.stopPropagation()">
      <button class="modal-close" (click)="cerrarPopup()">
        <i class="fas fa-times"></i>
      </button>
      <h3>¡Cotización Enviada!</h3>
      <p>Tu solicitud ha sido enviada exitosamente.</p>
    </div>
  </div>
</div>