<div class="calendar-container">
    <h2 class="main-title">Paso 4: Selecciona el periodo de tu estad√≠a</h2>
    
    <!-- Botones de selecci√≥n r√°pida para fechas comunes -->
    <div class="predefined-ranges">
    <h3 style="margin-bottom: 20px;">Selecci√≥n r√°pida</h3>
    <div class="range-buttons">
        <button 
        *ngFor="let range of predefinedRanges" 
        class="range-btn"
        (click)="onPredefinedRangeClick(range)">
        {{range.label}}
        </button>
    </div>
    </div>

    <!-- Layout principal con calendario y panel de informaci√≥n -->
    <div class="main-layout">
    <!-- Calendario de fechas -->
    <div class="calendar">
        <!-- Navegaci√≥n entre meses -->
        <div class="calendar-header">
        <button class="nav-btn" (click)="previousMonth()">‚Äπ</button>
        <h2 class="month-year">{{currentMonthYear}}</h2>
        <button class="nav-btn" (click)="nextMonth()">‚Ä∫</button>
        </div>

        <!-- Encabezados de d√≠as de la semana -->
        <div class="weekdays">
        <div class="weekday" *ngFor="let day of weekDays">{{day}}</div>
        </div>

        <!-- Grid de d√≠as del mes con estados visuales -->
        <div class="calendar-grid">
        <div 
            *ngFor="let day of calendarDays" 
            class="calendar-day"
            [class.current-month]="day.isCurrentMonth"
            [class.selected]="day.isSelected"
            [class.in-range]="day.isInRange"
            [class.start-date]="day.isStartDate"
            [class.end-date]="day.isEndDate"
            [class.disabled]="day.isDisabled"
            [class.other-month]="!day.isCurrentMonth"
            (click)="onDateClick(day)">
            {{day.date.getDate()}}
        </div>
        </div>
    </div>

    <!-- Panel lateral con informaci√≥n de la reserva -->
    <div class="selection-panel">
        <!-- Informaci√≥n cuando ya hay fechas seleccionadas -->
        <div class="selection-info" *ngIf="selectedRange.startDate">
        <h3>Tu reserva</h3>
        <div class="selected-dates">
            <div class="date-item">
            <label>Check-in:</label>
            <span class="date-value">{{selectedRange.startDate | date:'dd/MM/yyyy'}}</span>
            </div>
            <div class="date-item" *ngIf="selectedRange.endDate">
            <label>Check-out:</label>
            <span class="date-value">{{selectedRange.endDate | date:'dd/MM/yyyy'}}</span>
            </div>
        </div>
        
        <!-- Contador de d√≠as y noches -->
        <div class="nights-count" *ngIf="selectedRange.endDate">
            <span class="days-info">
                <span>üìÖ</span>
                <span>{{selectedDaysCount}} d√≠as</span>
            </span>
            <span class="nights-info">
                <span>üåô</span>
                <span>{{selectedDaysCount - 1}} {{selectedDaysCount - 1 === 1 ? 'noche' : 'noches'}}</span>
            </span>
        </div>

        <!-- Desglose de costos cuando hay caba√±a seleccionada -->
        <div class="cost-info" *ngIf="selectedRange.endDate && tieneCabanaSeleccionada">
            <div class="cost-item">
                <span class="cost-label">{{nombreCabana}}</span>
                <span class="cost-value">{{costoPorNoche | currency:'COP':'symbol-narrow':'1.0-0'}}/noche</span>
            </div>
            
            <div class="cost-total">
                <span class="total-label">Total hospedaje:</span>
                <span class="total-value">{{costoTotalEstadia | currency:'COP':'symbol-narrow':'1.0-0'}}</span>
            </div>
        </div>

        <!-- Advertencia cuando no se ha seleccionado caba√±a -->
        <div class="no-cabin-warning" *ngIf="selectedRange.endDate && !tieneCabanaSeleccionada">
            <div class="warning-content">
                <span class="warning-icon">‚ö†Ô∏è</span>
                <div class="warning-text">
                    <strong>Primero selecciona una caba√±a</strong>
                    <small>Para ver el costo de tu estad√≠a, necesitas elegir una caba√±a primero</small>
                </div>
            </div>
        </div>
        </div>
        
        <!-- Estado inicial cuando no hay fechas seleccionadas -->
        <div class="selection-placeholder" *ngIf="!selectedRange.startDate">
        <h3>Selecciona tus fechas</h3>
        <p>Elige tu fecha de entrada y salida</p>
        <small>M√≠nimo 2 d√≠as (1 noche), m√°ximo 7 d√≠as consecutivos</small>
        </div>
        
        <!-- Estado intermedio cuando solo hay fecha de entrada -->
        <div class="selection-status" *ngIf="selectedRange.startDate && !selectedRange.endDate">
        <h3>Selecciona fecha de salida</h3>
        <p>Ya tienes tu fecha de llegada, ahora elige cuando te ir√°s</p>
        </div>
    </div>
    </div>

    <!-- Bot√≥n para reiniciar la selecci√≥n -->
    <div class="calendar-actions">
    <button class="clear-btn" (click)="clearSelection()">Limpiar selecci√≥n</button>
    </div>

    <!-- Modal para mostrar errores de validaci√≥n -->
    <div class="error-modal" *ngIf="showErrorModal" (click)="closeErrorModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
        <h3>Error en la reserva</h3>
        <button class="close-btn" (click)="closeErrorModal()">√ó</button>
        </div>
        <div class="modal-body">
        <p>{{errorMessage}}</p>
        </div>
        <div class="modal-footer">
        <button class="error-btn" (click)="closeErrorModal()">Entendido</button>
        </div>
    </div>
    </div>
</div>