<div class="formulario-section">
  <div class="formulario-container">
    <h2 class="formulario-titulo">Cotiza tu experiencia</h2>
    <p class="formulario-subtitulo">Complete sus datos para finalizar la reserva</p>

    <div *ngIf="mensajeEnviado" class="mensaje-confirmacion">
      <i class="fas fa-check-circle"></i> ¬°Tu informaci√≥n fue enviada exitosamente!
    </div>

    <form method="" id="cotizar-form" (ngSubmit)="onSubmit($event)">
      <div class="form-group">
        <label for="nombre">Nombre</label>
        <i class="fas fa-user"></i>
        <input type="text" class="form-control" id="nombre" name="nombre" required>
      </div>

      <div class="form-group">
        <label for="email">Correo electr√≥nico</label>
        <i class="fas fa-envelope"></i>
        <input type="email" class="form-control" id="email" name="email" required>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="telefono">Tel√©fono</label>
          <i class="fas fa-phone"></i>
          <input type="tel" class="form-control" id="telefono" name="telefono" required>
        </div>

        <div class="form-group">
          <label for="fecha">Fecha de llegada</label>
          <i class="fas fa-calendar"></i>
          <input type="date" class="form-control" id="fecha" name="fecha" required>
        </div>
      </div>

      <div class="form-group">
        <label for="comentarios">Comentarios</label>
        <i class="fas fa-comment"></i>
        <textarea class="form-control" id="comentarios" name="comentarios" rows="3"
          placeholder="Solicitudes especiales, preguntas adicionales..."></textarea>
      </div>

      <div class="resumen-container">
        <h4>Resumen de tu reserva:</h4>
        <ul id="resumen-reserva">
          <li *ngIf="!tieneCabana && !tieneActividades && !tieneComidas" class="resumen-vacio">
            <div class="mensaje-vacio">
              <i class="fas fa-info-circle"></i>
              <p>Selecciona una caba√±a, actividades o comidas para ver tu resumen</p>
            </div>
          </li>

          <!-- Caba√±a -->
          <li *ngIf="tieneCabana" class="resumen-item">
            <div class="item-info">
              <strong>üè† Caba√±a seleccionada</strong>
              <span class="item-detalles">{{ datosCotizacion.cabana?.capacidad }} - {{ datosCotizacion.cantidadPersonas
                }} {{ datosCotizacion.cantidadPersonas === 1 ? 'persona' : 'personas' }}</span>
            </div>
            <span class="item-precio">{{ '$' + formatearPrecio(datosCotizacion.cabana?.precio ?? 0) }}</span>
          </li>

          <!-- Actividades -->
          <ng-container *ngIf="tieneActividades">
            <li class="resumen-categoria"><strong>üéØ Actividades seleccionadas:</strong></li>
            <li class="resumen-item actividad" *ngFor="let act of datosCotizacion.actividades">
              <div class="item-info">
                <span class="actividad-nombre">{{ act.nombre }}</span>
                <span class="item-detalles">
                  {{ act.porPersona ? ('$' + formatearPrecio(act.precio) + ' x ' + datosCotizacion.cantidadPersonas + '
                  personas') : 'Precio fijo' }}
                </span>
              </div>
              <span class="item-precio">{{ '$' + formatearPrecio(act.precioTotal) }}</span>
            </li>
          </ng-container>

          <!-- Comidas -->
          <ng-container *ngIf="tieneComidas">
            <li class="resumen-categoria"><strong>üçΩÔ∏è Comidas seleccionadas:</strong></li>
            <li class="resumen-item comida" *ngFor="let comida of datosCotizacion.comidas">
              <div class="item-info">
                <span class="comida-nombre">{{ comida.nombre }}</span>
                <span class="item-detalles">
                  {{ comida.porPersona ? ('$' + formatearPrecio(comida.precioUnitario) + ' x ' +
                  datosCotizacion.cantidadPersonas + ' personas') : 'Precio fijo' }}
                </span>
              </div>
              <span class="item-precio">{{ '$' + formatearPrecio(comida.precioTotal) }}</span>
            </li>
          </ng-container>

          <!-- Subtotal e IVA -->
          <ng-container *ngIf="tieneCabana || tieneActividades || tieneComidas">
            <li class="resumen-subtotal total">
              <div class="item-info"><span>Subtotal</span></div>
              <span class="item-precio">{{ '$' + formatearPrecio(datosCotizacion.subtotalCabana +
                datosCotizacion.subtotalActividades + datosCotizacion.subtotalComidas) }}</span>
            </li>
            <li class="resumen-iva">
              <div class="item-info"><span>IVA (19%)</span></div>
              <span class="item-precio">{{ '$' + formatearPrecio((datosCotizacion.subtotalCabana +
                datosCotizacion.subtotalActividades + datosCotizacion.subtotalComidas) * 0.19) }}</span>
            </li>
          </ng-container>
        </ul>

        <h4 class="total-resumen">Total: <span>{{ '$' + formatearPrecio(datosCotizacion.total + datosCotizacion.total *
            0.19) }}</span></h4>
      </div>

      <div class="botones-container">
        <button type="button" class="btn-volver" id="volver-btn" (click)="onVolver()">Volver</button>
        <button type="button" class="btn-cotizar" id="cotizar-btn" (click)="cotizar()">Cotizar</button>
      </div>
      <div *ngIf="mensajeEnviado" class="mensaje-enviado">
        Informaci√≥n enviada, un asesor se comunicar√° con usted
      </div>
    </form>

    <!-- Modal popup -->
    <!-- Modal popup mejorado -->
    <div class="modal-backdrop" *ngIf="mostrarPopup" (click)="cerrarPopup()">
      <div class="modal" (click)="$event.stopPropagation()">
        <!-- Bot√≥n de cerrar opcional -->
        <button class="modal-close" (click)="cerrarPopup()">
          <i class="fas fa-times"></i>
        </button>

        <!-- Header con icono de √©xito -->
        <div class="modal-header">
          <div class="modal-success-icon">
            <i class="fas fa-check"></i>
          </div>
          <h3>¬°Cotizaci√≥n Enviada!</h3>
        </div>

        <!-- Cuerpo del modal -->
        <div class="modal-body">
          <p>Tu solicitud ha sido enviada exitosamente. Un asesor se comunicar√° contigo pronto para confirmar los
            detalles de tu reserva.</p>

          <div class="modal-buttons">
            <button class="modal-button" (click)="cerrarPopup()">
              <i class="fas fa-thumbs-up"></i> Perfecto
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>